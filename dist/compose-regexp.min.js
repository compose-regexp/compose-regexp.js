!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("compose-regexp",["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).composeRegexp={})}(this,(function(n){"use strict";const e=[];"dgimsuy".split("").forEach((function(n){try{new RegExp("",n),e.push(n)}catch(n){}}));const t=-1!==e.indexOf("u"),r=(()=>{try{return new RegExp("(?<=)"),!0}catch(n){return!1}})(),u={}.hasOwnProperty;function o(n){return n}const i=[].map,c=RegExp;function s(n){return-1===n.indexOf("\\")?n:JSON.parse('"'+n.replace(/$|"|\\x([\dA-Fa-f]{2})|\\u\{([\dA-Fa-f]{1,6})\}/g,(function(n,e,t){return""===n?'"':'"'===n?'\\"':String.fromCodePoint(parseInt(e||t,16))})))}const f={value:void 0,writable:!1,enumerable:!1,configurable:!1};function l(){return"_"+Math.floor(Math.random()*Math.pow(2,32)).toString(36)}const a="undefined"!=typeof WeakMap?new WeakMap:{key:"__$$__compose_regexp__$$__"+l()+l()+l()+l(),set:function(n,e){const t=typeof n;if(null==n||"object"!==t&&"function"!==t)throw new TypeError("Bad WeakMap key");const r=n[a.key];if(!r)return f.value={keys:[this],values:[e]},Object.defineProperty(n,a.key,f),this;const u=r.keys.indexOf(this);return 0===u?(r.keys.push(this),r.values.push(e),this):(r.values[u]=e,this)},get:function(n){const e=n[a.key];if(e){const n=e.keys.indexOf(this);if(-1!==n)return e.values[n]}}},d=/\\[^]|\(\?(?::|<?[=!])|[\[\](]/g,p=/\\.|\.|\(\?:\^\|\(\?<=\[\\n\\r\\u2028\\u2029\]\)\)|\(\?:\$\|\(\?=\[\\n\\r\\u2028\\u2029\]\)\)|\[|\]|\^|\$/g,g=t&&new RegExp("^[_$\\p{ID_Start}][$\\p{ID_Continue}]*$","u"),h=/\\.|\{\d+,?\d*\}|(\[|\]|\{|\})/g,y=/(?:$|(?=[\n\r\u2028\u2029]))/,x=/(?:^|(?<=[\n\r\u2028\u2029]))/,w=/\\[^1-9]|[\[\]]|\\(\d{1,2})|\$d:(\d+),n:(\d+)\^/g,k=/^(?:\\.|\[(?:[^\]\\]|\\.)*\])$/,m=/^\\p\{[A-Za-z][A-Za-z=]*\}$/,$=/[.?*+^$[\]\\(){}|]/g,E=/^(?:[+*?]|\{(\d+)(?:,(\d*))?\})\??$/,R=/(\\.)|[-()|\[\]]((?=\?<?[=!]))?/g,b=/\\u[0-9A-Fa-f]{4}|\\x[0-9A-Fa-f]{2}|\\c[A-Za-z]|\\([^.?*+^$[\]\\(){}|\/DSWdswfnrtv-])|(\\[DSWdsw]-[^\]]|.-\\[DSWdsw])|\\.|\]/g,S=/\\u[0-9A-Fa-f]{4}|\\x[0-9A-Fa-f]{2}|\\c[A-Za-z]|\\k<(.*?)>|\\([^.?*+^$[\]\\(){}|\/DSWdswBbfnrtv])|\\.|\.|\[\^\]|\[|(\((?:\?[^])?)|(\)(?:[+?*]|\{\d+,?\d*\})?)/g;function A(n){if(n instanceof c){let e=a.get(n);return null==e&&a.set(n,e={captureCount:null,direction:0,hasRefs:null,hasFinalRef:null,isDisjunction:null,isOneGroupOrAssertion:null,source:null,unicode:null}),e}return n||{captureCount:null,direction:0,hasRefs:null,hasFinalRef:null,isDisjunction:null,isOneGroupOrAssertion:null,source:null,unicode:null}}const O=function(n,e,t){const r=A(n);return"object"==typeof e?Object.assign(r,e):r[e]=t},I=function(n,e){return A(n)[e]};function j(n,e){return Object.defineProperty((function(t){const r=I(t.key,n);return null!=r?r:O(t.key,n,e(t))}),"name",{value:n})}const F=[];const v=j("captureCount",(function(n){let e,t=0;for(d.lastIndex=0;e=d.exec(n.source);)"("===e[0]&&(t+=1);return t})),B=j("hasRefs",(function(n){let e,t=!1,r=!1,u=!1;for(w.lastIndex=0;e=w.exec(n.source);)u||null==e[1]&&null==e[2]?"["===e[0]?u=!0:"]"===e[0]&&(u=!1):(t=!0,w.lastIndex===n.source.length&&(r=!0));return O(n.key,"hasFinalRef",r),t})),C=/\\\\|\\\{|(\{\d+(?:,\d*)?\}$)/g,_=/^\d*(?:,\d*)?\}/;const M=j("isDisjunction",(function(n){if(-1===n.source.indexOf("|"))return!1;let e,t=0,r=!1;for(R.lastIndex=0;e=R.exec(n.source);)if(null==e[1]&&(r||"("!==e[0]||t++,r||")"!==e[0]||t--,r||"["!==e[0]&&"[-"!==e[0]||(r=!0),r&&"]"===e[0]&&(r=!1),0===t&&!r&&"|"===e[0]))return!0;return!1})),D=j("isOneGroupOrAssertion",(function(n){const e=n.source;if("("!==e.charAt(0)||")"!==e.charAt(e.length-1))return!1;let t,r=0,u=!1;for(R.lastIndex=0;t=R.exec(e);)if(null==t[1]){if(u||"("!==t[0]||r++,!u&&")"===t[0]&&(r--,0===r&&t.index!==e.length-1))return!1;u||"["!==t[0]&&"[-"!==t||(u=!0),u&&"]"===t[0]&&(u=!1)}else if(t.index===e.length-2)return!1;return!0}));function U(n){const e=n.source;if(null==e||"^"===e||"$"===e||"\\b"===e||"\\B"===e)throw new SyntaxError(`Nothing to repeat: / ${e||"(?:)"}/`);if(1===e.length||k.test(e)||Z.U&&m.test(e))return!1;if(!D(n))return!0;if(/^\(\?<?[!=]/.test(e))throw new SyntaxError(`Nothing to repeat: /${e}/`);return!1}function N(n){const e=n.source;if(Z.U&&("regexp"===n.kind&&!n.key.unicode||"result"===n.kind&&!I(n.key,"unicode"))){if(function(n){let e,t=S;function r(n){n.lastIndex=t.lastIndex,t=n}for(F.length=0,S.lastIndex=0;e=t.exec(n);)if(t===S)if("["===e[0])r(b);else{if("."===e[0]||"[^]"===e[0]||null!=e[1]&&!g.test(s(e[1]))||null!=e[2])return!0;if(null!=e[3])F.unshift(e[3]);else if(null!=e[4]){if(("(?="===F[0]||"(?!"===F[0])&&")"!==e[4])return!0;F.shift()}}else if("]"===e[0])r(S);else if(null!=e[1]||null!=e[2])return!0;return!1}(e))throw new SyntaxError(`Can't upgrade the RegExp to Unicode /${e}/${"regexp"===n.kind?n.key.flags:""}`);n.source=function(n){let e=!1;return n.replace(h,(function(n,t){if("]"===n){if(!e)return"\\]";e=!1}else if(!e&&null!=t){if("["!==t)return"\\"+t;e=!0}return n}))}(e)}let t=!1;return"regexp"===n.kind&&(n.key.dotAll||n.key.multiline)&&(n.source=e.replace(p,(function(e){return t?("]"===e&&(t=!1),e):("["===e&&(t=!0),n.key.dotAll&&"."===e?"[^]":n.key.multiline&&"^"===e&&r?x.source:n.key.multiline&&"$"===e&&r?y.source:e)}))),n}const T=new RegExp(`^(?:([${e.join("")}])(?!.*\\1))*$`),W=new RegExp(`[${e.join()}]`,"g");const z={"-1":"backward",1:"forward"};function P(n){return n?function(n,e){return n.source=null==n.source?e.source:`${e.source}|${n.source}`,n}:function(n,e){return n.source=null==n.source?e.source:e.source+("string"!==e.kind&&B(e)&&I(e.key,"hasFinalRef")&&/^\d/.test(n.source)||function(n,e){const t=e.source.match(_);if(null==t)return!1;const r=n.source+t[0];let u;for(C.lastIndex=0;u=C.exec(r);)if(null!=u[1])return!0;return!1}(e,n)?"(?:)":"")+n.source,n}}let Z,G,q={current:1};function J(){G={hasRefs:!1,hasFinalRef:!1,captureCount:0},Z={U:!1,I:null,M:null}}function H(n,e){return e.condition&&!e.condition(n)||(n.source=e.open+(n.source||"")+")"),e.suffix&&(n.source+=e.suffix),n}function K(n){return H(n,{condition:function(n){return("regexp"===n.kind||"result"===n.kind)&&M(n)},open:"(?:"})}function L(n,e,t,u){return t=t||n.length>1,i.call(n,(function n(u){return(!e&&t?K:o)(Array.isArray(u)?L(u,!1,t,0):"function"==typeof u?n(function(n){const e=G,t=Z;try{return n()}finally{G=e,Z=t}}(u)):u instanceof c?function(n){const e=I(n.key,"direction");if(e*q.current==-1)throw new TypeError(`Illegal ${z[e]} RegExp argument while building a ${z[q.current]} one: /${n.source}/`);return 0!==e&&(G.hasRefs=!0),n}(function(n){const e=n.key.flags;if(!T.test(e))throw new TypeError(`Unkown flag(s): ${e.replace(W,"")}`);const t=!!n.key.unicode,u=n.key.ignoreCase,o=n.key.multiline;if(null!=Z.I&&u!==Z.I)throw new SyntaxError("Can't combine i and non-i regexps: "+n.key);if(!r&&null!=Z.M&&o!==Z.M)throw new SyntaxError("Can't combine m and non-m regexps: "+n.key);return Z.I=u,Z.M=o,Z.U=Z.U||t,n}({key:u,kind:"regexp",source:(i=u,I(i,"source")||O(i,"source",i.source))})):function(n){if("number"==typeof n||"string"==typeof n)return{key:null,kind:"string",source:String(n).replace($,"\\$&")};throw new TypeError(`Can't compose type ${typeof n} as RegExp`)}(u));var i})).map(N).map(function(n){let e=n;return function(t){if("regexp"===t.kind||"result"===t.kind){if(B(t)){G.hasRefs=!0;let r=!1;t.source=t.source.replace(w,(function(t,u,o,i){if(!r){if(null!=u){const n=Number(u)+e;if(n>99)throw new RangeError("Back reference index larger than 99");return"\\"+String(n)}if(null!=o){if("0"===o){const e=Number(i)+n;if(e>99)throw new RangeError("Back reference index larger than 99");return"\\"+String(e)}return`$d:${Number(o)-1},n:${i}^`}}return"["===t?r=!0:"]"===t&&(r=!1),t}))}G.hasFinalRef=!!I(t.key,"hasFinalRef"),e+=v(t)}return G.captureCount=e,t}}(u)).reduceRight(P(e),{key:O(null,Object.assign({direction:G.hasRefs?q.current:0,isDisjunction:e&&(n.length>1||1===n.length&&n[0]instanceof c&&I(n[0],"isDisjunction")),unicode:Z.U},G)),kind:"result",source:null})}function Q(){return(Z.I?"i":"")+(r?"":Z.M?"m":"")+(Z.U?"u":"")}function V(n,e){e=e||{};const t=u.call(e,"flags")?e.flagsOp(Q(),e.flags):Q(),r=e.either,o=new RegExp(r?n.source||"[]":n.source||"",t);return O(o,O(n.key,{})),O(o,"source",n.source),u.call(e,"direction")&&O(o,"direction",e.direction),o}const X=/(?:)/,Y=/[]/;function nn(n){if(!r)throw new Error("no support for /(?<=...)/ which is required by "+n+"()")}function en(...n){return 0===n.length?Y:(J(),V(L(n,!0,!1,0),{either:!0}))}function tn(...n){return L(n,!1,!1,0)}function rn(...n){return 0===n.length?X:(J(),V(tn(...n)))}function un(n,e,t,r,u){return function(...o){if(null!=r&&r(u),!o.length)return t;const i=q.current;q.current=e;try{J();return V(H(tn(...o),{open:n}),{direction:0})}finally{q.current=i}}}const on=un("(?=",1,X),cn=un("(?!",1,Y),sn=un("(?<=",-1,X,nn,"lookBehind"),fn=un("(?<!",-1,Y,nn,"notBehind");function ln(n,...e){if(J(),0===e.length)throw new SyntaxError("Suffix to an empty prefix");return V(H(tn(...e),{condition:U,open:"(?:",suffix:n}))}function an(n,...e){"string"!=typeof n&&(n="{"+String(n)+"}");const t=n.match(E);if(!t||t[2]&&Number(t[2])<Number(t[1]))throw new SyntaxError("Invalid suffix '"+n+"'.");return 0===e.length?ln.bind(null,n):ln(n,...e)}ln.call;const dn=an("?");function pn(n){return!t||g.test(s(n))}function gn(n,e){if(!function(n){const e=typeof n;return"string"===e&&pn(n)||"number"===e&&0<n&&Math.round(n)===n}(n))throw new SyntaxError("Bad ref: "+n);if(null!=e&&("number"!=typeof e||e<1||e!=e|0))throw new RangeError("Bad depth: "+e);if("string"==typeof n)return new RegExp("\\k<"+n+">");const t=new RegExp("$d:"+(e||"0")+",n:"+n+"^");return O(t,{direction:q.current,hasFinalRef:!0,hasRefs:!0}),t}function hn(...n){J();return V(H(L(n,!1,!1,1),{open:"("}))}function yn(n,...e){if("string"!=typeof n)throw new TypeError("String expected, got "+typeof n);pn(n),J();return V(H(L(e,!1,!1,1),{open:"(?<"+n+">"}))}function xn(n,e){return n=n.split(""),e.split("").forEach((function(e){-1===n.indexOf(e)&&n.push(e)})),n.sort().join("")}function wn(n,...e){J(),-1!==n.indexOf("u")&&(Z.U=!0);return V(tn(...e),{flagsOp:xn,flags:n})}const kn={add:function(n,...e){if("string"!=typeof n)throw TypeError("String expected as first argument, got "+typeof n);if(!T.test(n))throw new SyntaxError("Invalid flags: "+n);return 0===e.length?wn.bind(null,n):wn(n,...e)}};const mn=t&&new RegExp("[^]","u");function $n(n,e){return rn(cn(e),n)}const En={difference:$n,intersection:function(n,e){return rn(on(e),n)},complement:function(n){return $n(t&&n.unicode?mn:/[^]/,n)},union:en};n.atomic=function(...n){return 1===q.current?rn(on(hn(...n)),gn(1)):rn(gn(1),sn(hn(...n)))},n.bound=function(n){return nn("bound"),en([fn(n),on(n)],[sn(n),cn(n)])},n.capture=hn,n.charSet=En,n.either=en,n.flags=kn,n.lookAhead=on,n.lookBehind=sn,n.maybe=dn,n.namedCapture=function(n,...e){return 0===e.length?yn.bind(null,n):yn(n,...e)},n.noBound=function(n){return nn("noBound"),en([fn(n),cn(n)],[sn(n),on(n)])},n.notAhead=cn,n.notBehind=fn,n.ref=gn,n.sequence=rn,n.suffix=an}));
